#
# "THE BEER-WARE LICENSE" (Revision CS-42):
#
# This file was written by the CodeShop developers.  As long as you
# retain this notice you can do whatever you want with it.
# If we meet some day, and you think this file is worth it, you can
# buy us a beer in return.  Even if you do that, this file still
# comes WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
#

import os ;
import errors ;

if [ os.environ prereqs-install-dir ] = ""
{
  errors.error "prereqs-install-dir must be set" ;
}
path-constant prereqs-install-dir : [ os.environ prereqs-install-dir ] ;

project oss
: requirements
  <cxxstd>17
  <toolset>msvc:<cxxflags>/wd4251 # class needs to have dll-interface 
  <toolset>msvc:<cxxflags>/wd4275 # non dll-interface class used as base
  <toolset>msvc:<cxxflags>/wd4910 # dllexport on extern template
  <target-os>windows:<define>NOMINMAX
  <target-os>windows:<define>WIN32_LEAN_AND_MEAN
  <threading>multi
  <target-os>linux:<linkflags>-Wl,--enable-new-dtags
  <target-os>linux:<linkflags>-Wl,-rpath,\\$ORIGIN/../lib
: default-build
# <variant>release
  <address-model>64
  <debug-symbols>on
;

use-project /cuti : cuti/cuti ;
use-project /x264 : $(prereqs-install-dir)/lib/jamfiles/x264 ;
use-project /x264_proto : x264_proto/x264_proto ;

build-project cuti/cuti ;
build-project x264_proto/x264_proto ;
build-project x264_encoding_service ;

explicit unit_tests ;
alias unit_tests : cuti/unit_tests x264_encoding_service/unit_tests ;

explicit install ;
alias install : x264_encoding_service//install ;
